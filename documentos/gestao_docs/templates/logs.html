{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4"><i class="bi bi-clipboard-data"></i> Logs do Sistema</h2>

    <form method="get" class="mb-4 d-flex gap-2 align-items-center">
        <select name="filtro" class="form-select w-auto">
            <option value="funcionarios" {% if filtro == 'funcionarios' %}selected{% endif %}>Funcionários</option>
            <option value="documentos" {% if filtro == 'documentos' %}selected{% endif %}>Documentos</option>
        </select>
        <button type="submit" class="btn btn-outline-primary">
            <i class="bi bi-filter"></i> Filtrar
        </button>
    </form>

    {% if filtro == 'funcionarios' and page_func %}
    <h4 class="mb-3 text-primary"><i class="bi bi-person-lines-fill"></i> Funcionários - Modificações Recentes</h4>
    <table class="table table-striped table-hover align-middle">
        <thead class="table-light">
            <tr>
                <th>Nome</th>
                <th>Criado por</th>
                <th>Atualizado por</th>
                <th>Criado em</th>
                <th>Atualizado em</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for func in page_func %}
            <tr>
                <td>{{ func.nome }}</td>
                <td>{% if func.criado_por %}{{ func.criado_por.username }}{% else %}<span class="text-muted">---</span>{% endif %}</td>
                <td>{% if func.atualizado_por %}{{ func.atualizado_por.username }}{% else %}<span class="text-muted">---</span>{% endif %}</td>
                <td>{{ func.created_at|date:"d/m/Y H:i" }}</td>
                <td>{{ func.updated_at|date:"d/m/Y H:i" }}</td>
                <td>
                    {% if func.created_at == func.updated_at %}
                        <span class="badge bg-success">Criado</span>
                    {% else %}
                        <span class="badge bg-warning text-dark">Atualizado</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <nav class="mt-3">
        <ul class="pagination justify-content-center">
            {% for num in page_func.paginator.page_range %}
                <li class="page-item {% if page_func.number == num %}active{% endif %}">
                    <a class="page-link" href="?filtro=funcionarios&page_func={{ num }}">{{ num }}</a>
                </li>
            {% endfor %}
        </ul>
    </nav>
    {% endif %}

    {% if filtro == 'documentos' and page_doc %}
    <h4 class="mb-3 text-success"><i class="bi bi-file-earmark-text"></i> Documentos - Modificações Recentes</h4>
    <table class="table table-striped table-hover align-middle">
        <thead class="table-light">
            <tr>
                <th>Documento</th>
                <th>Funcionário</th>
                <th>Criado por</th>
                <th>Atualizado por</th>
                <th>Criado em</th>
                <th>Atualizado em</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for doc in page_doc %}
            <tr>
                <td>{{ doc.nome_documento }}</td>
                <td>{{ doc.funcionario.nome }}</td>
                <td>{% if doc.criado_por %}{{ doc.criado_por.username }}{% else %}<span class="text-muted">---</span>{% endif %}</td>
                <td>{% if doc.atualizado_por %}{{ doc.atualizado_por.username }}{% else %}<span class="text-muted">---</span>{% endif %}</td>
                <td>{{ doc.created_at|date:"d/m/Y H:i" }}</td>
                <td>{{ doc.updated_at|date:"d/m/Y H:i" }}</td>
                <td>
                    {% if doc.created_at == doc.updated_at %}
                        <span class="badge bg-success">Criado</span>
                    {% else %}
                        <span class="badge bg-warning text-dark">Atualizado</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <nav class="mt-3">
        <ul class="pagination justify-content-center">
            {% for num in page_doc.paginator.page_range %}
                <li class="page-item {% if page_doc.number == num %}active{% endif %}">
                    <a class="page-link" href="?filtro=documentos&page_doc={{ num }}">{{ num }}</a>
                </li>
            {% endfor %}
        </ul>
    </nav>
    {% endif %}

</div>
{% endblock %}
